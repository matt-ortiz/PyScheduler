[supervisord]
nodaemon=true
user=root
logfile=/var/log/supervisord.log
childlogdir=/var/log/supervisor

[program:nginx]
command=/usr/sbin/nginx -g "daemon off;"
autostart=true
autorestart=true
stderr_logfile=/var/log/nginx_error.log
stdout_logfile=/var/log/nginx_access.log

[program:redis]
command=/usr/bin/redis-server /etc/redis/redis.conf
autostart=true
autorestart=true
stderr_logfile=/var/log/redis_error.log
stdout_logfile=/var/log/redis.log

[program:fastapi]
command=python -m uvicorn backend.main:app --host 127.0.0.1 --port 8001 --workers 1
directory=/app
environment=PYTHONPATH="/app"
autostart=true
autorestart=true
stderr_logfile=/var/log/fastapi_error.log
stdout_logfile=/var/log/fastapi.log

[program:celery_worker]
command=python -m celery -A backend.tasks worker --loglevel=info --concurrency=2
directory=/app
environment=PYTHONPATH="/app"
autostart=true
autorestart=true
stderr_logfile=/var/log/celery_worker_error.log
stdout_logfile=/var/log/celery_worker.log

[program:celery_beat]
command=python -m celery -A backend.tasks beat --loglevel=info
directory=/app
environment=PYTHONPATH="/app"
autostart=true
autorestart=true
stderr_logfile=/var/log/celery_beat_error.log
stdout_logfile=/var/log/celery_beat.log

[program:init_db]
command=python -c "from backend.database import init_database; init_database()"
directory=/app
environment=PYTHONPATH="/app"
autostart=true
autorestart=false
startsecs=0
exitcodes=0
stderr_logfile=/var/log/init_db_error.log
stdout_logfile=/var/log/init_db.log